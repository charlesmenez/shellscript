#!/bin/sh 
cat << "EOF"
                                                              
                                                       ____   
                    ,---,               .---.        ,'  , `. 
                  .'  .' `\            /. ./|     ,-+-,.' _ | 
                ,---.'     \       .--'.  ' ;  ,-+-. ;   , || 
                |   |  .`\  |     /__./ \ : | ,--.'|'   |  ;| 
                :   : |  '  | .--'.  '   \' .|   |  ,', |  ': 
                |   ' '  ;  :/___/ \ |    ' '|   | /  | |  || 
                '   | ;  .  |;   \  \;      :'   | :  | :  |, 
                |   | :  |  ' \   ;  `      |;   . |  ; |--'  
                '   : | /  ;   .   \    .\  ;|   : |  | ,     
                |   | '` ,/     \   \   ' \ ||   : '  |/      
                ;   :  .'        :   '  |--" ;   | |`-'       
                |   ,.'           \   \ ;    |   ;/           
                '---'              '---"     '---'           

                         Dwm Auto Install Script
This script does work if you have doas with 'permit nopass :wheel' in doas.conf
EOF
sleep 2
echo "checking needed packages"
apps="feh convert picom pip3 git ssh setxkbmap"
folders="$HOME/sourcecode $HOME/Wallpapers $HOME/.local/bin"

for app in $apps; do
  if ! which $app > /dev/null; then
    echo "$app isn't installed, please install"
    sleep 4
    exit 1
  fi
done

sleep 1
echo "Checking folders and creating it"

for folder in $folders; do
  if [ ! -d $folder ]; then
    mkdir -p $HOME/sourcecode
    mkdir -p $HOME/Wallpapers
    mkdir -p $HOME/.local/bin
    break
  fi
done

echo "Clone the repos"
sleep 1
#clone the repos
git clone https://github.com/charlesmenez/dwm $HOME/sourcecode/dwm
git clone https://github.com/charlesmenez/dwmblocks $HOME/sourcecode/dwmblocks
git clone https://github.com/charlesmenez/dmenu $HOME/sourcecode/dmenu
git clone https://github.com/charlesmenez/st $HOME/sourcecode/st
doas cp $HOME/sourcecode/dwmblocks/scripts/* /usr/local/bin/
#pull the script and making it executable
doas curl -L https://raw.githubusercontent.com/charlesmenez/shellscript/main/dwm-colors -o /usr/local/bin/dwm-colors
doas chmod +x /usr/local/bin/dwm-colors
#downloading some wallpaper
curl -L https://raw.githubusercontent.com/charlesmenez/Wallpapers/main/dwm.png -o $HOME/Wallpapers/dwm.png
sleep 1
echo "checking if pywal it's installed, if not i'm install for you"
sleep 1
#check if pywal is installed
if ! pip3 show pywal > /dev/null; then
  pip install pywal --user
else
  echo "Congrats you have pywal, but make sure if it's in your PATH"
fi

doas ln -s ~/.local/bin/wal /usr/local/bin/

if [ ! -f "$HOME/.Xresources $HOME/.xinitrc" ]; then
  touch $HOME/.Xresources
  curl -L https://raw.githubusercontent.com/charlesmenez/dotfiles/main/xinitrc -o $HOME/.xinitrc
else
  nv $HOME/.xinitrc $HOME/.xinitrcbkp
  mv $HOME/.Xresources $HOME/.Xresourcesbkp
fi
wal -i $HOME/Wallpapers/dwm.png
cat ~/.cache/wal/colors.Xresources >> $HOME/.Xresources

doas make -C $HOME/sourcecode/st/ install
doas make -C $HOME/sourcecode/dwmblocks/ install
doas make -C $HOME/sourcecode/dwm/ install
doas make -C $HOME/sourcecode/dmenu/ install

